version: 2

sources:
  - name: csv
    schema: main 
    description: "Rådata som laddats in i DuckDB via dlt/Prefect"
    tables:
      - name: stage_patients  # dlt sparar oftast i gemener
        description: "Råa patientdata"
        columns:
          - name: patient_id
            tests:
              - unique
              - not_null

      - name: stage_doctors
        description: "Råa läkardata"

      - name: stage_clinics
        description: "Råa klinikdata"

      - name: stage_diagnosis
        description: "Råa diagnosdata"

      - name: stage_visits
        description: "Råa besöksdata"
        columns:
          - name: visit_id
            tests:
              - not_null
              - unique
              - dbt_utils.expression_is_true:
                  expression: " != 'NULL'"
                  severity: error

      - name: stage_date
        description: "Datumdimension"

  - name: sql_external_sources
    schema: main 
    description: "Rådata som laddats in i DuckDB via dlt/Prefect"
    tables:
      - name: stage_diagnosis_descriptions  # dlt sparar oftast i gemener
        description: "Råa diagnosbeskrivningar"